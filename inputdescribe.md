# OneDice 输入标准

## 运算符

### 普通多面掷骰 `d`
```
AdB(kq)C(pb)DaE
```
#### 简述
这是最基础的掷骰方式，即为掷`A`个面数为`B`的多面骰子，然后计算它们（全部或部分）的点数总和，即为该表达式的最终结果。  
当`a`存在时转变为骰池，等同`无限加骰池 a`的`Aa(B+1)kEmB`，即无加骰轮下计算不低于成功线的骰子个数。    

#### 参数介绍
 符号 | 参数 | 名称 | 解释 | 缺省 | 类别
 :---: | :---: | :--- | :--- | :--- | :---
 d | A | 骰数 | 掷出多少个骰子 | 1 | 左值
 d | B | 面数 | 掷出的骰子有多少面 | - | 右值
 k/q | C | 选取线 | 只选取最大/小骰子</br>结果的个数，k大q小 | A | 参数
 p/b | D | 奖惩数 | 追加奖惩骰的个数 | 0 | 参数
 a | E | 骰池 | 功能转换为骰池</br>结果转为记录不低于该值的骰子个数 | - | 参数

#### 附加说明
 - 面数`B`的缺省值通常由规则书决定，例如DND中通常为`20`，而COC中通常为`100`
 - `p/b`符号的奖惩骰规则来自COC，详见`惩罚骰/奖励骰`，该参数将强制覆写`B`为`100`，并对`A`个骰子中每一只都进行`C`个该操作
 - `k/q`符号与`p/b`符号不可同时使用
 - `a`符号存在时，其余参数全部失效


### 惩罚骰/奖励骰 `p/b`
```
A(pb)B
```
#### 简述
这是来自COC的掷骰方式，即为掷`1`个面数为`100`的多面骰子(实质上为：范围`0~9`的`10`面个位骰；范围`0~9`的`10`面十位骰，其中当出值为`0`时记作`100`)，再掷`B`个面数为`10`的`惩罚骰/奖励骰`，用其中`最大/最小`点数替换原先的十位骰，然后计算它们（全部或部分）的点数总和，即为该表达式的最终结果。  

#### 参数介绍
 符号 | 参数 | 名称 | 解释 | 缺省 | 类别
 :---: | :---: | :--- | :--- | :--- | :---
 p/b | A | - | 无意义 | 1 | 左值
 p/b | B | 面数 | 追加奖惩骰的个数 | 1 | 右值


### 无限加骰池 `a`
```
AaBkCqDmE
```
#### 简述
这是常见于无限规则的掷骰方式，即为掷`A`个面数为`E`的多面骰子，计算点数不低于`B`的骰子个数，然后以此为新的骰子个数进行下一轮掷骰，直到下一轮掷骰不存在，然后求出所有累计结果中点数不低于`C`(如果有)以及不高于`D`(如果有)的骰子个数，即为该表达式的最终结果。  

#### 参数介绍
 符号 | 参数 | 名称 | 解释 | 缺省 | 类别
 :---: | :---: | :--- | :--- | :--- | :---
 a | A | 初始骰数 | 第一轮掷出多少个骰子 | - | 左值
 a | B | 加骰线 | 每有一枚不低于该值</br>则下一轮掷骰增加一枚骰子 | - | 右值
 k | C | 成功线 | 最终计算不低于该参数的骰子个数 | 8 | 参数
 q | D | 反向成功线 | 最终计算不高于该参数的骰子个数 | - | 参数
 m | E | 面数 | 掷出的骰子有多少面 | 10 | 参数


### 双重十字加骰池 `c`
```
AcBmC
```
#### 简述
这是常见于双重十字规则的掷骰方式，即为掷`A`个面数为`C`的多面骰子，计算点数不低于`B`的骰子个数，然后以此为新的骰子个数进行下一轮掷骰，直到下一轮掷骰不存在，最后一轮记其最大值，此前每一轮记为`C`点，然后累加每一轮的点数总和。  

#### 参数介绍
 符号 | 参数 | 名称 | 解释 | 缺省 | 类别
 :---: | :---: | :--- | :--- | :--- | :---
 c | A | 初始骰数 | 第一轮掷出多少个骰子 | - | 左值
 c | B | 加骰线 | 每有一枚不低于该值</br>则下一轮掷骰增加一枚骰子 | - | 右值
 m | C | 面数 | 掷出的骰子有多少面 | 10 | 参数


### FATE掷骰池 `f`
```
AfB
```
#### 简述
理论上，`FATE`规则发展自`Fudge`规则。  
这是常见于FATE规则的掷骰方式，即为掷`A`个面数为`3`的多面骰子，该骰子的三面分别为`+`/`-`/`0`，分别计为`1`、`-1`、`0`，计算所有骰子点数总和，即为该表达式的最终结果。  

#### 参数介绍
 符号 | 参数 | 名称 | 解释 | 缺省 | 类别
 :---: | :---: | :--- | :--- | :--- | :---
 f | A | 骰数 | 掷出多少个骰子 | 4 | 左值
 f | B | - | 无意义 | 3 | 右值

### 多元组 `[]`
```
[A,B,C,D,...]
```
#### 简述
多元组在格式上是被`[`和`]`包裹的，被一系列`,`分隔的表达式(或称元素)，如上例子，将会顺序执行`A`、`B`、`C`、`D`……直到多元组结束。  
这种表达式可以实现表达式的嵌套与多条表达式的组合，并且可以配合`kh`、`kl`或`lp`来实现特殊的操作。  

#### 参数介绍
 符号 | 参数 | 名称 | 解释 | 缺省 | 类别
 :---: | :---: | :--- | :--- | :--- | :---
 `[]` | A B C D ... | 表达式序列 | 顺序执行 | - | 序列

#### 附加说明
+ 逗号表达式：对于那些与多元组结合没有特殊操作的运算符，默认情况下，多元组的值将为最后一个表达式的值，如`[2,3]d100`实际等同于`3d100`。  
+ 多态：部分运算符同时具有数值与多元组类型的计算结果，实际使用哪一个取决于与它结合的下一级运算符，例如`2d100`可以同时具有`127`和`[84,43]`的效果，所以`2d100d2`等同于`127d2`，`2d100kh`等同于`[84,43]kh`。  

### 优势劣势/最大最小 `kh/kl`
```
A(kh/hl)B
```
#### 简述
这是常见于DND规则的掷骰方式，这种算符需要与多元组或者具有多元组结果的算符配合使用，例如`d`、`f`、`[]`。  
这个算符的意思即为将`A`的计算结果转换为多元组，比较其中各个表达式结果的大小，取其中`最大/最小`的`B`个点数，然后计算这些点数的总和；  
其中`kh`对应最大，而`kl`对应最小。  

#### 参数介绍
 符号 | 参数 | 名称 | 解释 | 缺省 | 类别
 :---: | :---: | :--- | :--- | :--- | :---
 kh/kl | A | 待比较取值的表达式 | 一个具有多元组结果的表达式 | - | 左值
 kh/kl | B | 取多少个数字求和 | 无意义 | 1 | 右值

#### 附加说明
+ 本运算符优先获取其左值表达式的多元组结果，无多元组结果的表达式将被视为只有一个表达式的多元组。  

### 循环 `lp`
```
AlpB
```
#### 简述
`lp`算符支持快速使用循环，其左侧的`A`与循环次数、单次步进以及变量相关，可以是数值或者多元组，右侧的`B`则是被作为循环体的多元组。  

#### 参数介绍
 符号 | 参数 | 名称 | 解释 | 缺省 | 类别
 :---: | :---: | :--- | :--- | :--- | :---
 lp | A | 循环标识 | 用于标识循环次数与步进<br />详见附加说明 | - | 左值
 lp | B | 循环体 | 用于被多次循环计算的表达式 | - | 右值

#### 附加说明
+ `A`循环标识可以有以下多种格式：
  + `X`单个数值，则为从`1`至`X`以单次步进`1`，循环至等于`X`为止，包括`X`
  + `[X]`单个元素的多元组，等同`X`单个数值
  + `[X,Y]`两个元素的多元组，则为从`X`至`Y`以单次步进`1`，循环至等于`Y`为止，包括`Y`
  + `[X,Y,Z]`两个元素的多元组，则为从`X`至`Z`以单次步进`Y`，循环至等于`Z`为止，包括`Z`
+ `B`必须为多元组，元素数量不限，将按照循环顺序执行，并将每次循环的执行结果拼接为一个完整的多元组
+ 特别的，`B`中的每个元素可以用符号`i`来引用本次循环的循环变量。

#### 临时变量 `$t`
```
$tA=B
$tA
```
#### 简述
`$t`算符支持存入和读取临时变量，可以用于其它涉及到多元组的环境。  
当`=`子运算符存在时，将向标号为`A`的临时变量存入`B`。  
无论`=`子运算符是否存在，`$t`运算符的结果都等于本次运算后标号为`A`的临时变量中最终所存储的值。  

#### 参数介绍
 符号 | 参数 | 名称 | 解释 | 缺省 | 类别
 :---: | :---: | :--- | :--- | :--- | :---
 `$t` | A | 临时变量标号 | 将操作标号为`A`的变量 | - | 右值
 `=` | B | 被赋值数 | 将把`B`进行赋值 | - | 参数


## 运算法则

### 初等代数
除了上一节所包括的各类扩展运算符，还支持进行初等代数相关的运算。
 符号 | 名称 | 备注
 :---: | :---: | :---
 `+` | 加法 | -
 `-` | 减法 | -
 `*`</br>x | 乘法 | -
 / | 除法 | 只取整数部分
 ^ | 幂 | -
 ( | 左括号 | 详见运算优先级
 ) | 右括号 | 详见运算优先级


### 运算优先级
当不存在括号`(`、`)`时，表达式中的初等运算符遵守从左往右，从优先级高到优先级低的运算方式，优先级等级如下：
 符号 | 等级
 :---: | :---:
 `+` | 1
 `-` | 1
 `*`</br>x | 2
 / | 2
 ^ | 3
 d | 4
 a | 4
 c | 4
 f | 4
 ( | -
 ) | -

当存在括号的时候，括号内的表达式优先计算。
